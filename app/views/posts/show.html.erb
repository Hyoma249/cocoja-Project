<!-- app/views/posts/show.html.erb -->
<div class="mx-auto min-h-screen pb-16 bg-gray-50">
  <%= render "shared/header/login_header" %>

  <div class="container mx-auto px-4 py-8 md:pl-[calc(288px+2rem)] md:pr-8">
    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
      <!-- 投稿のヘッダー部分 -->
      <div class="p-4 border-b flex">
        <%= link_to user_path(@post.user), class: "flex items-center hover:opacity-75 transition-opacity" do %>
          <div class="w-10 h-10 rounded-full bg-gray-100 flex-shrink-0 overflow-hidden mr-3">
            <% if @post.user.profile_image_url.present? %>
              <img src="<%= @post.user.profile_image_url %>" alt="<%= @post.user.username %>" class="w-full h-full object-cover">
            <% else %>
              <%= image_tag "sample_icon1.svg", alt: @post.user.uid, class: "w-full h-full object-cover" %>
            <% end %>
          </div>

          <div>
            <p class="font-semibold"><%= @post.user.uid %></p>
            <p class="text-xs text-gray-500"><%= l @post.created_at, format: :long %></p>
          </div>
        <% end %>

        <!-- 都道府県情報 -->
        <div class="mt-2 ml-4">
          <span class="inline-block bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded">
            <%= @post.prefecture.name %>
          </span>
        </div>
      </div>

      <!-- 投稿の内容 -->
      <div>
        <!-- 投稿画像があれば表示 - Swiperに変更 -->
        <% if @post.post_images.present? %>
          <div class="relative overflow-visible pb-8" data-controller="swiper">
            <div class="swiper w-full md:aspect-[4/3] aspect-square" data-swiper-target="container">
              <div class="swiper-wrapper">
                <% @post.post_images.each_with_index do |post_image, index| %>
                  <div class="swiper-slide">
                    <% if post_image.image.present? && post_image.image.url.present? %>
                      <%= image_tag post_image.image.url,
                                  class: "w-full h-full object-contain select-none",
                                  draggable: "false",
                                  loading: "lazy" %>
                    <% else %>
                      <div class="w-full h-full bg-gray-900 flex items-center justify-center text-white select-none">
                        <span>画像なし</span>
                      </div>
                    <% end %>
                  </div>
                <% end %>
              </div>

              <!-- インジケーターとページネーション -->
              <% if @post.post_images.length > 1 %>
                <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-full z-10">
                  <span class="swiper-index">1</span>/<%= @post.post_images.length %>
                </div>

                <!-- ページネーション -->
                <div class="swiper-pagination"></div>
              <% end %>
            </div>
          </div>
        <% end %>

        <div class="prose max-w-none px-4 py-4">
          <!-- 投稿内容表示部分（ハッシュタグと改行の両方を処理） -->
          <%= format_content_with_hashtags(@post.content) %>
        </div>

        <!-- ハッシュタグがあれば表示 -->
        <% if @post.hashtags.present? %>
          <div class="px-4 pb-4 flex flex-wrap gap-1">
            <% @post.hashtags.each do |hashtag| %>
              <%= link_to "/posts/hashtag/#{hashtag.name}", class: "text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-full" do %>
                #<%= hashtag.name %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- ポイント付与フォーム -->
    <%= render 'vote_form', post: @post %>
  </div>
  <%= render "shared/footer/login_footer" %>
</div>