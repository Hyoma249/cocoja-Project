<div id="vote_form" class="mt-6 border-t pt-4">
  <h3 class="text-lg font-medium mb-2">この投稿にポイントを付ける</h3>

  <% if !current_user %>
    <p class="text-gray-600">
      <%= link_to "ログイン", new_user_session_path, class: "text-indigo-600 hover:underline" %>
      するとポイントを付けられます
    </p>
  <% elsif current_user == post.user %>
    <p class="text-gray-600">自分の投稿にはポイントを付けられません</p>
  <% elsif current_user.votes.today.exists?(post: post) %>
    <p class="text-yellow-600">この投稿には既に今日ポイントを付けています</p>
  <% elsif current_user.remaining_daily_points <= 0 %>
    <p class="text-red-600">本日のポイント上限（5ポイント）に達しています</p>
  <% else %>
    <div class="mb-2">
      <p class="text-sm text-gray-600">
        残りポイント: <span class="font-medium"><%= current_user.remaining_daily_points %></span>ポイント
      </p>
    </div>

    <%= form_with(model: [post, Vote.new], 
                  data: { turbo: true, controller: "vote" }) do |f| %>
      <div class="flex space-x-2" data-vote-target="pointButtons">
        <% [1, 2, 3, 4, 5].each do |point| %>
          <% if point <= current_user.remaining_daily_points %>
            <%= f.radio_button :points, point,
                             class: "sr-only peer",
                             id: "vote_points_#{point}",
                             data: { action: "change->vote#selectPoint" } %>
            <label for="vote_points_<%= point %>"
                 class="cursor-pointer px-4 py-2 rounded border border-indigo-500 
                        peer-checked:bg-indigo-500 peer-checked:text-white 
                        transition-colors duration-200">
              <%= point %>
            </label>
          <% else %>
            <span class="px-4 py-2 rounded border border-gray-300 
                       text-gray-300 cursor-not-allowed">
              <%= point %>
            </span>
          <% end %>
        <% end %>
      </div>

      <%= f.submit "投票する",
                class: "mt-3 px-4 py-2 bg-indigo-600 text-white rounded 
                       hover:bg-indigo-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",
                data: { vote_target: "submitButton" },
                disabled: true %>
    <% end %>
  <% end %>
</div>